<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracking Page1</title>
    <link rel="stylesheet" href="./css/TrackingPage.css">
</head>

<body>
    <section class="main">
        <h1>BUIE Garbage Vehicle Tracker</h1>
        <section class="container">
            <div class="map">WIP</div>
            <div class="track" id="trackContainer">
                <!-- Cards will be dynamically added here -->
            </div>
        </section>
    </section>

    <script>
        // Function to extract query parameters from the URL
        function getQueryParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Function to fetch dustbin count from the API
        function fetchDustbinCount(areaId) {
            return fetch(`https://garbage-collect-backend.onrender.com/get-all-areas`)
                .then(response => response.json())
                .then(data => {
                    // Find the area with the given areaId
                    const area = data.find(area => area.areaId === areaId);

                    // Return the dustbin count for the area
                    return area ? area.dustbins.length : 0;
                })
                .catch(error => {
                    console.error('Error fetching dustbin count:', error);
                    return 0;
                });
        }

        // Get areaId from the URL
        const areaId = getQueryParameter('areaId');

        // Fetch card count from the API using the obtained areaId
        fetch(`https://garbage-collect-backend.onrender.com/get-dustbin-count/${areaId}`)
            .then(response => response.json())
            .then(data => {
                // Dynamically add cards based on the API response
                let cardCount = data.dustbinCount;
                let trackContainer = document.getElementById('trackContainer');

                for (let i = 0; i < cardCount; i++) {
                    // Create a card element
                    let card = document.createElement('div');
                    card.className = 'card';

                    // Create status elements
                    let statusContainer = document.createElement('div');
                    statusContainer.className = 'status';

                    let arrivedStatus = document.createElement('span');
                    arrivedStatus.className = 'arrived';
                    arrivedStatus.textContent = 'Not Arrived Yet';

                    let departedStatus = document.createElement('span');
                    departedStatus.className = 'departed';
                    departedStatus.textContent = 'Not Departed Yet';

                    statusContainer.appendChild(arrivedStatus);
                    statusContainer.appendChild(departedStatus);

                    // Create circle element
                    let circle = document.createElement('div');
                    circle.className = 'circle';

                    // Append status and circle elements to the card
                    card.appendChild(statusContainer);
                    card.appendChild(circle);

                    // Append the card to the track container
                    trackContainer.appendChild(card);

                    // Fetch dustbin count for the areaId obtained from the previous page
                    fetchDustbinCount(areaId).then(dustbinCount => {
                        // Log or use the dustbin count as needed
                        console.log('Dustbin Count:', dustbinCount);
                    });
                }

                // Simulating order progress
                let currentProgress = 5;
                updateOrderProgress(currentProgress);
            })
            .catch(error => console.error('Error fetching data:', error));

        // Simulating order progress
        function updateOrderProgress(progress) {
            // Select all circles, arrived, and departed spans
            let circles = document.querySelectorAll('.circle');
            let arrivedStatuses = document.querySelectorAll('.arrived');
            let departedStatuses = document.querySelectorAll('.departed');

            // Reset styles for all circles and statuses
            circles.forEach(circle => circle.style.backgroundColor = 'gray');
            arrivedStatuses.forEach(status => {
                status.textContent = 'Not Arrived Yet';
                status.classList.remove('arrived');
            });
            departedStatuses.forEach(status => {
                status.textContent = 'Not Departed Yet';
                status.classList.remove('departed');
            });

            // Set styles based on progress
            for (let i = 0; i < progress; i++) {
                let circle = circles[i];
                let arrivedStatus = arrivedStatuses[i];
                let departureStatus = departedStatuses[i];

                arrivedStatus.textContent = 'Arrived';
                arrivedStatus.classList.add('arrived');
                departureStatus.textContent = 'Departed';
                departureStatus.classList.add('departed');
                circle.style.backgroundColor = 'green';
            }
        }
    </script>
</body>

</html>
